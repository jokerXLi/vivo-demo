<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>vivo智能手机官方商城</title>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.js"></script>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/shoppingcar.css">
    <script src="../js/jquery.js"></script>
    <script src="../layer/layer.js"></script>
    <script src="../js/car.js"></script>
</head>

<body>
    <div class="header header1">
        <ul class="fl header-left">
            <li><a href="#">品牌</a></li>
            <li><a href="#">Funtouch OS</a></li>
            <li><a href="#">体验店</a></li>
            <li><a href="#">政企业务</a></li>
            <li><a href="#">社区</a></li>
        </ul>
        <ol class="fr header-right">
            <li><a href="./shoppingcar.html" class="gwc">购物车</a></li>
            <li><a href="./login.html">登录</a></li>
            <img src="../images/xtb.png" alt="">
            <li><a href="./register.html">注册</a></li>
        </ol>
    </div>

    <div class="header header2" style="display: none;">
        <ul class="fl header-left">
            <li><a href="#">品牌</a></li>
            <li><a href="#">Funtouch OS</a></li>
            <li><a href="#">体验店</a></li>
            <li><a href="#">政企业务</a></li>
            <li><a href="#">社区</a></li>
        </ul>
        <ol class="fr header-right">
            <li><a href="./shoppingcar.html" class="gwc">购物车</a></li>
            <li><a href="#">个人中心</a></li>
        </ol>
    </div>
    <!-- header end -->

    <div class="nav">
        <div class="main">
            <a href="./index.html"><img src="../images/log2.png" alt="" class="log"></a>
            <ul class="nav-center" style="float: left;">
                <li><a href="#">iQOO专区</a></li>
                <li><a href="#">NEX系列</a></li>
                <li><a href="#">X系列</a></li>
                <li><a href="#">S系列</a></li>
                <li><a href="#">Z系列</a></li>
                <li><a href="#">Y系列</a></li>
                <li><a href="#">U系列</a></li>
                <li><a href="./index.html" id="store">商城</a></li>
                <li><a href="#">服务</a></li>
            </ul>
            <a href="#"><img src="../images/search.png" alt="" class="search"></a>
        </div>
    </div>
    <!-- nav end -->

    <div class="top">
        <div class="main top-center">
            <h3>我的购物车</h3>
            <a href="./index.html">继续购物&nbsp;&nbsp;&gt;</a>
        </div>
    </div>
    <!-- top end -->

    <div class="content">
        <div class="main content-center">
            <p>哎呀，购物车为空！</p>
            <div>
                <button id="shop">去选购逛逛</button>
                <button id="save">我的收藏</button>
            </div>
        </div>
    </div>
    <!-- content end -->

    <div class="content1">
        <div class="main content-center1">
            <div class="ctop">
                <table class="order-table">
                    <tr>
                        <th>
                            <label>
                                <i class="checkbox all checked"></i>
                                <a href="#">全选</a>
                            </label>
                        </th>
                        <th>商品名称</th>
                        <th>价格（元）</th>
                        <th>数量</th>
                        <th>优惠</th>
                        <th>赠送积分</th>
                        <th>小计（元）</th>
                        <th>操作</th>
                    </tr>
                </table>
            </div>

            <div id="mycart"></div>

            <div class="cbottom">
                <ul class="fl u1">
                    <li>
                        <label>
                            <i class="checkbox all checked"></i>
                            <a href="#">全选</a>
                        </label>
                    </li>
                    <li>
                        <a style="cursor: pointer" onclick="delSelect()">删除选中的商品</a>
                    </li>
                    <li>
                        <a href="#">移入收藏夹</a>
                    </li>
                </ul>

                <div class="fr">
                    <div class="fl">
                        <p class="t1">已选商品<span style="color: #f51919;" class="ts1"></span>件，合计（不含运费）：<strong
                                style="color: #f51919;font-size:30px;" class="ts2"></strong></p>
                        <p class="t2">（商品总价：<span class="ts2"></span> 优惠：-￥0.00）</p>
                    </div>
                    <div class="fr">
                        <a href="#" class="amount">去结算</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="show clearfix">
        <div class="main show-center">
            <h3>猜你喜欢</h3>
            <div class="goods">
                <dl>
                    <dt><a href="#"><img src="../images/phone1.png" alt=""></a></dt>
                    <dd>
                        <p>X27 8GB+128GB版 雀羽蓝</p>
                        <p>升降式摄像头，19.5:9零界全面屏，4800万后...</p>
                        <p>￥3198</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone2.png" alt=""></a></dt>
                    <dd>
                        <p>Z1青春版4GB+64GB 黑金</p>
                        <p>6.26英寸刘海屏，八核处理器，Face Wake面...</p>
                        <p>￥1049</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone3.png" alt=""></a></dt>
                    <dd>
                        <p>iQOO 8GB+128GB 电光蓝</p>
                        <p>高通骁龙855旗舰处理器，44W闪充，超级...</p>
                        <p>￥3298</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone4.png" alt=""></a></dt>
                    <dd>
                        <p>NEX双屏版 10GB+128GB 冰原蓝</p>
                        <p>高通845AIE、星环溢彩屏，双屏多任务、夜...</p>
                        <p>￥4998</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone5.png" alt=""></a></dt>
                    <dd>
                        <p>U1 全面屏 3GB+32GB 极光色</p>
                        <p>6.2英寸水滴屏，4030mAh大电池，高通骁...</p>
                        <p>￥799</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone6.png" alt=""></a></dt>
                    <dd>
                        <p>X27 8GB+256GB 粉黛金</p>
                        <p>升降式摄像头，19.5:9零界全面屏，4800万后...</p>
                        <p>￥3598</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone7.png" alt=""></a></dt>
                    <dd>
                        <p>Z3 全面屏 6GB+64GB 极光蓝</p>
                        <p>骁龙710AIE处理器，6.3英寸水滴屏，双涡...</p>
                        <p>￥1548</p>
                    </dd>
                </dl>

                <dl>
                    <dt><a href="#"><img src="../images/phone8.png" alt=""></a></dt>
                    <dd>
                        <p>S1 6GB+128GB 冰湖蓝</p>
                        <p>零界全面屏，升降式摄像头，前置2480万...</p>
                        <p>￥2298</p>
                    </dd>
                </dl>

            </div>
        </div>
    </div>
    <!-- show end -->

    <div class="footer">
        <div class="main">
            <div class="footer-top">
                <ul>
                    <li><img src="../images/xtb1.png">官方正品</li>
                    <li><img src="../images/xtb2.png">顺丰极速达</li>
                    <li><img src="../images/xtb3.png">全国联保</li>
                    <li><img src="../images/xtb4.png">镭雕定制</li>
                </ul>
            </div>
            <div class="footer-center clearfix">
                <dl>
                    <dt>热门链接</dt>
                    <dd><a href="#">X27</a></dd>
                    <dd><a href="#">iQOO</a></dd>
                    <dd><a href="#">Z3</a></dd>
                    <dd><a href="#">vivo摄影</a></dd>
                    <dd><a href="#">查找手机</a></dd>
                    <dd><a href="#">常见问题</a></dd>
                </dl>
                <dl>
                    <dt>在线购买</dt>
                    <dd><a href="#">官方商城</a></dd>
                    <dd><a href="#">选购手机</a></dd>
                    <dd><a href="#">选购配件</a></dd>
                    <dd><a href="#">政企服务</a></dd>
                    <dd><a href="#">以旧换新</a></dd>
                    <dd><a href="#">服务保障</a></dd>
                </dl>
                <dl>
                    <dt>服务支持</dt>
                    <dd><a href="#">服务首页</a></dd>
                    <dd><a href="#">服务网点查询</a></dd>
                    <dd><a href="#">真伪查询</a></dd>
                    <dd><a href="#">服务政策</a></dd>
                    <dd><a href="#">预约维修</a></dd>
                    <dd><a href="#">维修配件价格</a></dd>
                </dl>
                <dl>
                    <dt>vivo社区</dt>
                    <dd><a href="#">社区首页</a></dd>
                    <dd><a href="#">摄影专区</a></dd>
                    <dd><a href="#">微博</a></dd>
                    <dd><a href="#">贴吧</a></dd>
                    <dd><a href="#">兴趣部落</a></dd>
                </dl>
                <dl>
                    <dt>关于vivo</dt>
                    <dd><a href="#">vivo简介</a></dd>
                    <dd><a href="#">工作机会</a></dd>
                    <dd><a href="#">新闻资讯</a></dd>
                    <dd><a href="#">采购平台</a></dd>
                    <dd><a href="#">开放平台</a></dd>
                </dl>

                <dl class="lastdl">
                    <dt><a href="#">在线客服</a></dt>
                    <dd>
                        <p style="color: #415fff;font-size:20px;font-weight: bold;">400-678-9688</p>
                        <p style="color: #333333;font-size:14px;">24小时全国服务热线</p>
                    </dd>
                    <dd style="color: #333333;font-size:14px;">关注vivo
                        <a href="#"><img src="../images/xtb6.png" alt=""></a>
                        <a href="#"><img src="../images/xtb7.png" alt=""></a>
                        <a href="#"><img src="../images/xtb8.png" alt=""></a>
                    </dd>
                </dl>
            </div>
            <div class="footer-bottom">
                <p>
                    Copyright &copy;2011-2019 广东步步高电子工业有限公司 版权所有 保留一切权力 |
                    <a href="#">隐私政策</a> |
                    <a href="#">法律声明</a> |
                    <a href="#">粤B2-20080267</a> |
                    <a href="#">粤ICP备05100288号</a>&nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="#"><img src="../images/xtb9.png" alt="">&nbsp;&nbsp;</a> |&nbsp;&nbsp;
                    <a href="#"><img src="../images/xtb10.png" alt="">中国</a>
                </p>
            </div>
        </div>
    </div>
</body>
<script>
    $('#shop').click(function () {
        location.href = "./index.html";
    });
    //切换头部
    var username = document.cookie;
    console.log(username);
    if (username) {
        $('.header1').css('display', 'none');
        $('.header2').css('display', 'block');
    }
    else {
        $('.header1').css('display', 'block');
        $('.header2').css('display', 'none');
    }

    //获取本地存储中的购物车商品
    var car = new Car();
    var cartlist = car.getCar();
    console.log(cartlist);
    //循环购物车商品
    if (cartlist.length > 0) {
        $('.content').css('display', 'none');
        $('.content1').css('display', 'block');
        var str = ``;
        for (var i = 0; i < cartlist.length; i++) {
            str += `
        <div class="cmiddle">
                <table class="order-table">
                    <tbody id="tbody">
                        <tr>
                            <td class="check-col">
                                <label>
                                    <i class="checkbox one checked" onclick="select(this)"></i>
                                </label>
                            </td>
                            <td class="pro-pic">
                                <div class="cmtd1"><img src="${cartlist[i].img}" alt="" index="${cartlist[i].id}"></div>
                            </td>
                            <td class="goods-col">
                                <a href="#">${cartlist[i].title}</a><br>
                                <em style="font-style:normal">${cartlist[i].color}</em>
                            </td>
                            <td class="price-col">${cartlist[i].price}</td>
                            <td>
                                <div class="cmtd3">
                                    <button id="sub" onclick="sub(this)">-</button>
                                    <div id="number" title="请输入购买量">${cartlist[i].number}</div>
                                    <button id="puls" onclick="puls(this)">+</button>
                                </div>
                            </td>
                            <td>0.00</td>
                            <td>${parseInt(cartlist[i].price)}</td>
                            <td><span>${(cartlist[i].price * cartlist[i].number).toFixed(2)}</span></td>
                            <td>
                                <a href="#">加入到收藏夹</a><br>
                                <a onclick="del(${cartlist[i].id})" style="cursor: pointer;">删除</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `;
        }
        $('#mycart').html(str);
    }
    else {
        $('.content').css('display', 'block');
        $('.content1').css('display', 'none');
    }



    //商品总件数及总价
    $('.ts1').text(car.getTotalNumber());
    $('.ts2').text("￥" + car.getTotalPrice().toFixed(2));

    //商品数量加减及修改本地localstorage
    function sub(ele) {
        var parent = ele.parentNode;
        //获取tr
        var tr = parent.parentNode.parentNode;

        var tds = tr.children;
        //获取商品id
        var id = tds[1].children[0].children[0].getAttribute('index');
        var num = parent.children[1].innerText;
        if (num == 1) {
            return;
        }
        else {
            num--;
            parent.children[1].innerText = num;
            //构建商品对象，用于改变localStorage商品数量
            var product = {
                id: id,
                img: tds[1].children[0].getAttribute('src'),
                title: tds[2].children[0],
                color: tds[2].children[2],
                price: tds[3].innerText,
                number: num
            };
            //修改数量
            car.delfromCar(product);

            tds[7].children[0].innerText = (num * tds[3].innerText).toFixed(2);
            $('.ts1').text(car.getTotalNumber());
            $('.ts2').text("￥" + car.getTotalPrice().toFixed(2));
        }
    }

    function puls(ele) {
        //获取tr
        var tr = ele.parentNode.parentNode.parentNode;

        var tds = tr.children;
        //获取商品id
        var id = tds[1].children[0].children[0].getAttribute('index');

        var num = ele.parentNode.children[1].innerText;
        if (num == 5) {
            layer.alert('温馨提示：商品数量不可以超过5件', {
                title: "提示信息",
                // area:['400px','200px'],
                skin: 'layui-layer-molv',//样式类名
                closeBtn: 0
            });
        }
        else {
            num++;
            ele.parentNode.children[1].innerText = num;
            // console.log(tds[2].children[1]);
            //构建商品对象，用于存进localStorage
            var product = {
                id: id,
                img: tds[1].children[0].getAttribute('src'),
                title: tds[2].children[0],
                color: tds[2].children[2],
                price: tds[3].innerText,
                number: num
            };
            //加入本地存储中去，修改数量
            car.addToCar(product);


            tds[7].children[0].innerText = (num * tds[3].innerText).toFixed(2);

            $('.ts1').text(car.getTotalNumber());
            $('.ts2').text("￥" + car.getTotalPrice().toFixed(2));
        }
    }


    //实现选中
    $('.all').click(function () {
        if (!$(this).hasClass('checked')) {
            $('.checkbox').addClass('checked');
            $('.ts1').text(car.getTotalNumber());
            $('.ts2').text("￥" + car.getTotalPrice().toFixed(2));

        }
        else {
            $('.checkbox').removeClass('checked');
            $('.ts1').text('0');
            $('.ts2').text("￥0.00");
        }
    });

    function select(ele) {
        //获取tr
        var tr = ele.parentNode.parentNode.parentNode;
        var tds = tr.children;
        var num = tds[4].children[0].children[1].innerText;
        var price = tds[3].innerText;

        var one = $('.one');
        var flag = true;
        if (!$(ele).hasClass('checked')) {
            $(ele).addClass('checked');
            var ts1 = parseInt($('.ts1').text()) + num;
            var ts2 = parseFloat($('.ts2')[0].innerText.split("￥")[1]) + num * price;
            $('.ts1').text(ts1);
            $('.ts2').text("￥" + ts2.toFixed(2));
        }
        else {
            $(ele).removeClass('checked');
            var ts1 = parseInt($('.ts1').text()) - num;
            var ts2 = parseFloat($('.ts2')[0].innerText.split("￥")[1]) - num * price;
            $('.ts1').text(ts1);
            $('.ts2').text("￥" + ts2);
        }
        for (var i = 0; i < one.length; i++) {
            if (one[i].getAttribute('class').split(' ').length == 2) {
                flag = false;
                break;
            }
        }
        if (flag) {
            $('.all').addClass('checked');
            $('.ts1').text(car.getTotalNumber());
            $('.ts2').text("￥" + car.getTotalPrice().toFixed(2));

        }
        else {
            $('.all').removeClass('checked');
        }
    }

    //删除购物车商品
    function del(id) {
        layer.confirm('确定将该商品从购物车中删除吗？', {
            title: "提示信息",
            btn: ['确定', '取消'] //按钮
        }, function () {
            if (car.delGoods(id)) {
                location.reload();
            }
            else {
                layer.alert('删除失败', {
                    title: "提示信息",
                    skin: 'layui-layer-lan',//样式类名
                    closeBtn: 0
                });
            }
        }, function () {
            return;
        });
    }

    //删除选中的商品
    function delSelect() {
        layer.confirm('是否删除该商品？', {
            title: "提示信息",
            btn: ['删除', '移入收藏夹'] //按钮
        }, function () {
            var box = $('.one.checked');
            // console.log(box.parents('.cmiddle'));
            //获取tr
            var tr = box.parents('tr');
            // console.log(tr[0]);
            for (var i = 0; i < tr.length; i++) {
                var tds = tr[i].children;
                //获取商品id
                var id = tds[1].children[0].children[0].getAttribute('index');
                if (car.delGoods(id)) {
                    location.reload();
                }
                else {
                    layer.alert('删除失败', {
                        title: "提示信息",
                        skin: 'layui-layer-lan',//样式类名
                        closeBtn: 0
                    });
                }
            }
        }, function () {
            return;
        });
    }

    //显示购物车中的数量
    if (car.getTotalNumber() == 0) {
        $('.gwc').text('购物车');
    }
    else {
        $('.gwc').text('购物车(' + car.getTotalNumber() + ')');
    }

</script>

</html>